<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat Widget</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: transparent !important;
        overflow: hidden !important;
      }
    </style>
    <style>
      iframe[src*="chat-widget-wrapper"] {
        background: transparent !important;
        background-color: transparent !important;
      }
    </style>
    <!-- <script>
      const urlParams = new URLSearchParams(window.location.search);


      const tk = urlParams.get("tk") || "";


      //change vocodia-maxoderm-multi-widget
      const script = document.createElement("script");
      script.src = "https://connexusaiwidget.pages.dev/chat-widget.js";
      script.setAttribute("tk", tk);


      script.onload = () => {
        if (!window.__widget_initialized__) {
          try {
            initializeChatWidget();
          } catch (e) {}
          window.__widget_initialized__ = true;
        }
      };


      document.head.appendChild(script);
    </script> -->
    <script>
      // Parse tk from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const tk = urlParams.get("tk") || "";

      let parentOrigin = "";

      // Ask the parent for its origin
      window.parent.postMessage("REQUEST_PARENT_ORIGIN", "*");

      // Listen for the parent's response
      window.addEventListener("message", function (event) {
        parentOrigin = event.data.origin;
        if (event.data?.type === "PARENT_ORIGIN") {
          console.log("✅ Parent origin is:", parentOrigin);
          loadChatWidget(tk, parentOrigin);
        }
        if (event.data?.type === "TRIGGER_IFRAME_CLICK") {
          console.log(document.body.innerHTML);
          const micButton = document.querySelector(
            'img[alt="Available Microphone"], img[alt="Active Microphone"], img[alt="Offline Microphone"]'
          );

          if (micButton) {
            console.log(`Found: ${micButton.alt}`);
            micButton.click();
          }
        }
      });

      // Fallback in case message never arrives (e.g., blocked or unsupported)
      setTimeout(() => {
        if (!parentOrigin) {
          console.warn("⚠️ No response from parent. Using fallback.");
          loadChatWidget(tk, "unknown");
        }
      }, 1000);

      // Load the actual widget script
      function loadChatWidget(tk, origin) {
        const script = document.createElement("script");
        script.src = "https://fermaglo-widget.pages.dev/chat-widget.js";
        script.setAttribute("tk", tk);
        script.setAttribute("parent-origin", origin);

        console.log("origin!!!!!", origin);
        script.onload = () => {
          if (!window.__widget_initialized__) {
            try {
              initializeChatWidget({ origin });
            } catch (e) {
              window.__widget_initialized__ = true;
            }
          }
        };

        document.head.appendChild(script);
      }
    </script>
  </head>
  <body>
    <div id="widget-container"></div>
  </body>
</html>
